/* 
     _      ____    _____  __   __  _____   ____        ____    _____   _   _   ____    ___    ___  
    / \    |  _ \  | ____| \ \ / / | ____| / ___|      / ___|  |_   _| | | | | |  _ \  |_ _|  / _ \ 
   / _ \   | |_) | |  _|    \ V /  |  _|   \___ \      \___ \    | |   | | | | | | | |  | |  | | | |
  / ___ \  |  _ <  | |___    | |   | |___   ___) |  _   ___) |   | |   | |_| | | |_| |  | |  | |_| |
 /_/   \_\ |_| \_\ |_____|   |_|   |_____| |____/  (_) |____/    |_|    \___/  |____/  |___|  \___/ 
                                                                                                    
 */ 

!function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=33)}([function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));const a=i(7);class n{static verify(t){return t.pin?t:a.val(t)}static verifyPinLastValue(t){return t.pin?t.pinLastValue():t}static toRangeFixed(t,e,i){return a.clamp(a.toRange(t,e,i),e,i)}static convert(t,e){return typeof t===e?t:t.pinLastValue()}static vectorToPoint(t){return a.point(t.x,t.y,t.z)}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));class a{constructor(){this._queue=[],this._oneTimeQueue=[]}unsubscribeAll(){return this._queue=[],this._oneTimeQueue=[],this}unsubscribe(t){return this._queue=this._queue.filter(e=>e!==t),this._oneTimeQueue=this._oneTimeQueue.filter(e=>e!==t),this}subscribe(t){return this._queue.push(t),t}subscribeOnOne(t){return this._oneTimeQueue.push(t),t}fire(...t){return this._oneTimeQueue.forEach(e=>e(...t)),this._oneTimeQueue=[],this._queue.map(e=>e(...t))}}},function(t,e,i){"use strict";var a=i(1);const n=i(28);class s{static getActiveCameraEvent(t=function(t){}){n.captureDevicePosition.monitor({fireOnInitialValue:!0}).subscribe((function(e){t(e)}))}static getActiveCamera(){return n.captureDevicePosition.pinLastValue()}}var r=i(13);i.d(e,"a",(function(){return b}));const o=i(4);let l=[],c=5,d=!1,u="FIRST_LAUNCH",h=new a.a,f=new a.a,p=new a.a,m=new a.a,v=new a.a,g="FRONT",y=!0;class b{static _initialize(){return v.subscribe(()=>this.stopGame()),s.getActiveCameraEvent(t=>{t.newValue!==g&&d&&y&&v.fire()}),u=this.GameStates.FIRST_LAUNCH,Promise.resolve()}static startGame(){let t=i(16).default;l=[...t.getPlayersInSight()].slice(0,c),l.length<=0?o.log("ERROR: Game can not start with zero players"):!0!==d?s.getActiveCamera()!==g&&y?o.log("ERROR: Wrong camera selected"):(o.log("Game started with active players: "+t.getPlayersInSight().length),l.forEach(t=>{t.spawn(),t.onDeathEvent.subscribe(E)}),d=!0,u=this.GameStates.IN_PROGRESS,h.fire()):o.log("ERROR: Game is already in progress!")}static pauseGame(){u=this.GameStates.PAUSED,f.fire()}static resumeGame(){u=this.GameStates.IN_PROGRESS,p.fire()}static stopGame(){!1!==d&&(l.forEach(t=>{t.onDeathEvent.unsubscribe(E),r.a.deactivateAll()}),d=!1,u=this.GameStates.FINISHED,m.fire(),o.log(">>> GAME OVER <<<"))}static get gameState(){return u}static get GameStates(){return new class{get FIRST_LAUNCH(){return"FIRST_LAUNCH"}get IN_PROGRESS(){return"IN_PROGRESS"}get PAUSED(){return"PAUSED"}get FINISHED(){return"FINISHED"}}}static get inProgress(){return d}static set inProgress(t){d=t}static getCurrentPlayers(){return l}static get maxPlayers(){return c}static set maxPlayers(t){c=t}static setMainCamera(t){g=t}static get onGameStartedEvent(){return h}static get onGamePausedEvent(){return f}static get onGameResumedEvent(){return p}static get onGameOverEvent(){return m}static get onWrongCameraSelectedEvent(){return v}static get CameraTypes(){return new class{get FRONT(){return"FRONT"}get BACK(){return"BACK"}}}static set checkCamera(t){y=t}static get checkCamera(){return y}}function E(){l.every(t=>!t.active)&&b.stopGame()}},function(t,e,i){"use strict";var a=i(6),n=(i(8),i(15)),s=i(5);i(4);var r=i(10);i.d(e,"a",(function(){return p}));const o=i(14),l=i(4);let c,d=[],u={},h=[],f=!1;class p extends n.a{static setEntityFolder(t){return c=t,this}static getEntityFolder(){return r.a.root+c}static _initialize(){return p._formEntitiesArray(c)}static async _formEntitiesArray(t){return o.root.findByPath(r.a.root+t+"/*").then(e=>{void 0===t?l.log("ERROR: no entities folder provided. Use EntityManager.setEntityFolder()"):0===e.length&&l.log("ERROR: entities folder '"+t+"' not found!"),e.forEach(t=>{d.push([this._getEntityBuilder(t.name)])})}).then(()=>{d.forEach(e=>{o.root.findByPath(r.a.root+t+"/"+e[0].type+"/*").then(t=>{t.forEach(t=>{if("block_scene_object_model"!==t.identifier.split(":")[0]){d[d.indexOf(e)][1]||(d[d.indexOf(e)][1]=[]);let i=e[0].create(t);d[d.indexOf(e)][1].push(i)}})})})}),new Promise((t,e)=>{a.a.setTimeout(()=>{let e=h.filter(t=>!0!==t._abstract);d.length!==e.length&&l.log("WARNING: Количество билдеров и типов сущностей на совпадает! Билдеров сущностей: "+e.length+" | Типов сущностей на сцене: "+d.length);try{d.filter(t=>{if(void 0===t[0])return t}).forEach(t=>{l.log("ERROR: Тип из билдера "+h[d.indexOf(t)].type+" не найден на сцене!")})}catch(t){}t()},1)})}static _addEntityBuilder(t){!1===f&&(f=!0,s.a.addLoadableItem(p)),h.push(t)}static _getEntityBuilder(t){return h.filter(e=>e.type===t)[0]}static addEntityPreset(t){u[t.name]=t}static getEntityPreset(t){return u[t]}static getEntity(t){let e=void 0;return d.forEach(i=>{i[1].forEach(i=>{i.sceneObject.name===t&&(e=i)})}),e}static _getEntities(t=[],e){let i=[];return t.length>0?d.filter(e=>t.some(t=>e[0].type===t)).forEach(t=>{t[1].forEach(t=>{t.active===e&&!1===(e?t.deathAnimationActive:t.spawnAnimationActive)?i.push(t):void 0===e&&i.push(t)})}):d.forEach(t=>{t[1].forEach(t=>{t.active===e&&!1===(e?t.deathAnimationActive:t.spawnAnimationActive)?i.push(t):void 0===e&&i.push(t)})}),i}static getEntities(...t){return this._getEntities([...t])}static getEntitiesExcept(...t){return this._getEntities().filter(e=>![...t].some(t=>t===e.type))}static getActiveEntities(...t){return this._getEntities([...t],!0)}static getActiveEntitiesExcept(...t){return this._getEntities([],!0).filter(e=>![...t].some(t=>t===e.type))}static getInactiveEntities(...t){return this._getEntities([...t],!1)}static getInactiveEntitiesExcept(...t){return this._getEntities([],!1).filter(e=>![...t].some(t=>t===e.type))}}},function(t,e){t.exports=require("Diagnostics")},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));i(15);var a=i(2);const n=i(4);let s=[],r=[],o=[],l=[];class c{static async loadAll(t){try{c._addPredefinedLoadableItems();let t=s.map(t=>t._initialize());await Promise.all(t.map(t=>t.catch(t=>{n.log("ERROR: Ошибка инициализации одного из StaticLoadableItem'a: "+t)}))),await Promise.all(r),o.sort((t,e)=>e-t),o.forEach(t=>{t[0]()}),l.sort((t,e)=>e-t);let e=l.map(t=>t[0]());await Promise.all(e)}catch(t){n.log("ERROR: Loader не может асинхронно загрузить приложение из-за критической ошибки JavaScript"),n.log(t.message)}try{return t()}catch(t){n.log("ERROR: Невозможно выполнить коллбэк после выполнения метода Loader.loadAll()"),n.log(t.message)}}static addDeferredCallback(t,e=0){o.push([t,e])}static addDeferredAsyncCallback(t,e=0){l.push([t,e])}static addLoadableItem(t){return s.push(t),this}static addRequiredPromise(t){r.push(t)}static addLoadableItems(t=[]){return t.forEach(t=>s.push(t)),this}static _addPredefinedLoadableItems(){c.addLoadableItem(a.a)}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const a=i(21),n=i(4);class s{static setInterval(t,e){return void 0===t&&n.log("ОШИБКА: Не указан аргумент callback в вызове Timer.setInterval()"),void 0===e&&n.log("ОШИБКА: Не указан аргумент interval в вызове Timer.setInterval()"),s._createTimeDriver(t,e,!0)}static setTimeout(t,e){return void 0===t&&n.log("ОШИБКА: Не указан аргумент callback в вызове Timer.setTimeout()"),void 0===e&&n.log("ОШИБКА: Не указан аргумент interval в вызове Timer.setTimeout()"),s._createTimeDriver(t,e,!1)}static clearInterval(t){t.stop()}static _createTimeDriver(t,e,i){const n={durationMilliseconds:e,loopCount:i?1/0:1,mirror:!1};let s=a.timeDriver(n);return s.onAfterIteration().subscribe((function(){t()})),s.start(),s}}},function(t,e){t.exports=require("Reactive")},function(t,e,i){"use strict";i.r(e);var a=i(24),n=i(3),s=i(1),r=i(5),o=i(15);const l=i(4),c=i(27),d=i(30);let u={},h=[];class f extends o.a{static _initialize(){return Promise.all(h.map(t=>t()))}static get Builder(){return new class{loadTexture(t,...e){return p(c,t,...e),this}loadMaterial(t,...e){return p(d,t,...e),this}get ready(){return r.a.addLoadableItem(f),this}}}static getAsset(t){let e=this.getAssets(t)[0];return null==e&&l.log("ERROR: Невозможно выполнить getAsset(). Объект графики "+t+" не кэширован"),e}static getAssets(t){return u[t].length<=0&&l.log("ERROR: Невозможно выполнить getAssets(). Объекты графики "+t+" не кэшированы"),u[t]}static getMaterial(t){return this.getAsset(t)}static getMaterials(t){return this.getAssets(t)}static getTexture(t){return this.getAsset(t)}static getTextures(t){return this.getAssets(t)}}function p(t,e,...i){(void 0===i||i.length<=0)&&(i=[e]),i.forEach(i=>{h.push(()=>t.findFirst(i).then(t=>{void 0===t&&l.log("ERROR: Объект '"+e+"' с именем '"+i+"' не найден (AssetManager)"),void 0===u[e]&&(u[e]=[]),u[e].push(t)}))})}i.d(e,"default",(function(){return g})),i.d(e,"EntityBuilder",(function(){return y}));i(14);const m=i(7),v=i(4);i(27);class g extends a.a{constructor(t){super(),this.sceneObject=t.sceneObject,this.type=t.type,this.parentType=t.parentType;let e=this.sceneObject.findFirst("block").then(e=>{this.block=e,null==e?v.log("ERROR: entity "+t.sceneObject.name+" has no child 'block'"):(t._blockArgs.forEach(t=>this.block.inputs["set"+t.type.charAt(0).toUpperCase()+t.type.substring(1).toLowerCase()](t.name,t.value)),this.block.transform.position=m.point(0,0,0),this.block.transform.scale=m.vector(1,1,1),this.block.transform.rotationX=m.val(0),this.block.transform.rotationY=m.val(0),this.block.transform.rotationZ=m.val(0))});r.a.addRequiredPromise(e),this.onSpawnEvent=new s.a,this.onDeathEvent=new s.a,this.onHealthChangedEvent=new s.a,this.onStateChangedEvent=new s.a,this.onDamageEvent=new s.a,t._onSpawnEvent.forEach(t=>{this.onSpawnEvent.subscribe(t)}),t._onDeathEvent.forEach(t=>{this.onDeathEvent.subscribe(t)}),t._onHealthChangedEvent.forEach(t=>{this.onHealthChangedEvent.subscribe(t)}),t._onStateChangedEvent.forEach(t=>{this.onStateChangedEvent.subscribe(t)}),t._onDamageEvent.forEach(t=>{this.onDamageEvent.subscribe(t)}),this.onSpawnAnimation=t._onSpawnAnimation,this.onDeathAnimation=t._onDeathAnimation,this.sceneObjectName=t.sceneObject.name,this._active=!1,this._health=t._maxHealth,this.startHealth=t._startHealth,this.maxHealth=t._maxHealth,this.spawnAnimationActive=!1,this.deathAnimationActive=!1,this.immortality=!1,super.attachComponents(t.components)}static get Builder(){return new y}kill(t){this.deathAnimationActive=!0;let e=()=>{this._health=0,this._active=!1,this.onDeathEvent.fire(this,t),this.onDamageEvent.fire(this,t),this.onStateChangedEvent.fire(this),this.onHealthChangedEvent.fire(this),this.deathAnimationActive=!1};void 0!==this.onDeathAnimation?this.onDeathAnimation(this,t,e):e()}spawn(){this.spawnAnimationActive=!0;let t=()=>{this._health=this.startHealth,this._active=!0,this.onSpawnEvent.fire(this),this.onStateChangedEvent.fire(this),this.onHealthChangedEvent.fire(this),this.spawnAnimationActive=!1};void 0!==this.onSpawnAnimation?this.onSpawnAnimation(this,t):t()}damage(t=1,e){!0!==this.immortality&&(this.setHealth(this.health-t,e),this.onDamageEvent.fire(this))}addHealth(t=1,e){if(t<0)return void this.damage(Math.abs(t),e);let i;i=this.health+t>this.maxHealth?this.maxHealth:this.health+t,this.setHealth(i,e)}setHealth(t,e){this._health=t,t<=0?this.kill(e):this.onHealthChangedEvent.fire(this)}set health(t){this._health=t,t<=0?this.kill("zero health"):this.onHealthChangedEvent.fire(this)}get health(){return this._health}get active(){return this._active}}class y{constructor(){this._onSpawnEvent=[],this._onDeathEvent=[],this._onHealthChangedEvent=[],this._onStateChangedEvent=[],this._onDamageEvent=[],this._startHealth=void 0,this._maxHealth=1,this.components=[],this._blockArgs=[],this.type=void 0}extends(t){let e=n.a._getEntityBuilder(t);return void 0===e&&v.log("ERROR: Can't extend entity builder type '"+this.type+"' from type '"+t+"'. No builder of name '"+t+"' has been found"),this.components=e.components.slice(),this._onSpawnEvent=e._onSpawnEvent.slice(),this._onDeathEvent=e._onDeathEvent.slice(),this._onHealthChangedEvent=e._onHealthChangedEvent.slice(),this._onStateChangedEvent=e._onStateChangedEvent.slice(),this._onDamageEvent=e._onDamageEvent.slice(),this._onSpawnAnimation=e._onSpawnAnimation,this._onDeathAnimation=e._onDeathAnimation,this._startHealth=e._startHealth,this._maxHealth=e._maxHealth,this._blockArgs=e._blockArgs.slice(),this.parentType=t,this}abstract(){return this._abstract=!0,this}setName(t){return this.type=t,this}setStartHealth(t){return this._startHealth=t,this}setMaxHealth(t){return this._maxHealth=t,this}addComponent(t){return void 0===t?v.log("ERROR: addComponent() неправильно применён к билдеру типа сущностей "+this.type):this.components.push(t),this}addTransform(t){return this.addComponent(t),v.log("WARNING: Функция addTransform() устарела. Используйте addComponent() для добавления компонентов"),this}addCollider(t){return this.addComponent(t),v.log("WARNING: Функция addCollider() устарела. Используйте addComponent() для добавления компонентов"),this}addController(t){let e=this.components.filter(e=>e.constructor.name===t.constructor.name);return 0===e.length?(this.addComponent(t),t._main=!0):e[0]._addControllerBuilder(t),v.log("WARNING: Функция addController() устарела. Используйте addComponent() для добавления компонентов"),this}addStats(t){return this.addComponent(t),v.log("WARNING: Функция addStats() устарела. Используйте addComponent() для добавления компонентов"),this}get ready(){null==this._startHealth&&(this._startHealth=this._maxHealth),n.a._addEntityBuilder(this)}create(t){return this.sceneObject=t,new g(this)}addOnSpawnEvent(t){return this._onSpawnEvent.push(t),this}addOnDeathEvent(t){return this._onDeathEvent.push(t),this}addOnHealthChangedEvent(t){return this._onHealthChangedEvent.push(t),this}addOnStateChangedEvent(t){return this._onStateChangedEvent.push(t),this}addOnDamageEvent(t){return this._onDamageEvent.push(t),this}setOnSpawnAnimation(t){return this._onSpawnAnimation=t,this}setOnDeathAnimation(t){return this._onDeathAnimation=t,this}addBlockInput(t,e,i){return this._blockArgs.push({name:t,value:i,type:e}),this}addBlockTextureInput(t,e){return this.addBlockInput(t,"shader",f.getTexture(e).signal),this}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i(0);const n=i(7);i(4);class s{static Deg2Rad(t){return t*(Math.PI/180)}static Deg2RadReactive(t){return t.mul(n.val(Math.PI/180))}static Rad2Deg(t){return t*(180/Math.PI)}static Rad2DegReactive(t){return t.mul(n.val(180/Math.PI))}static GetRandomInt(t,e){return Math.floor(Math.random()*(e-t)+t)}static GetRandomFloat(t,e){return Math.random()*(e-t)+t}static InRange(t,e,i){return(t-e)*(t-i)<=0}static InRangeReactive(t,e,i){return n.or(n.lt(n.mul(t.sub(e),t.sub(i)),n.val(0)),n.eq(n.mul(t.sub(e),t.sub(i)),n.val(0)))}static chooseWeighted(t){let e=Object.keys(t),i=Object.values(t).map(t=>a.a.verifyPinLastValue(t)),n=i.reduce((t,e)=>t+e,0),s=0;i=i.map(t=>s+=t);let r=Math.random()*n,o=e[i.filter(t=>t<=r).length];return"0"===o?void 0:o}static chooseRandom(t){return t[this.GetRandomInt(0,t.length)]}static Vector(t=0,e=0,i=0){return{x:t,y:e,z:i}}static TranslationVector(t,e){return{x:{from:t.x,to:e.x},y:{from:t.y,to:e.y},z:{from:t.z,to:e.z}}}static GetDistance(t,e){return Math.sqrt((t-e)*(t-e))}static GetTranslationDistance(t){return this.GetDistance(t.x.from,t.x.to)+this.GetDistance(t.y.from,t.y.to)+this.GetDistance(t.z.from,t.z.to)}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var a=i(15),n=i(5);const s=i(14),r=i(4);let o={},l=[],c="Device/Camera/Focal Distance/";class d extends a.a{static _initialize(){return Promise.all(l.map(t=>t()))}static get Builder(){return new class{load(t,...e){return e.forEach((t,i)=>{e[i]=d.root+t}),this.loadByPath(t,...e),this}loadByPath(t,...e){return e.forEach(e=>{l.push(()=>s.root.findByPath(e).then(i=>{0===i.length&&r.log("ERROR: Объект '"+t+"' по адресу '"+e+"' не найден"),void 0===o[t]&&(o[t]=[]),o[t].push(i[0])}))}),this}loadFirst(t){return l.push(()=>s.root.findFirst(t).then(e=>{null==e?r.log("ERROR: Объект '"+t+"' не найден"):(void 0===o[t]&&(o[t]=[]),o[t].push(e))})),this}loadFolder(...t){return t.forEach(t=>{l.push(()=>s.root.findByPath(d.root+t+"/*").then(e=>{0===e.length&&r.log("ERROR: Папка по адресу '"+t+"' не существует или содержит 0 элементов"),e.forEach(t=>{void 0===o[t.name]&&(o[t.name]=[]),o[t.name].push(t)})}))}),this}loadChildren(t,...e){return e.forEach(e=>{l.push(()=>s.root.findByPath(d.root+e+"/*").then(i=>{0===i.length&&r.log("ERROR: Папка '"+t+"' по адресу '"+e+"' не существует или содержит 0 элементов"),void 0===o[t]&&(o[t]=[]),o[t].push(...i)}))}),this}loadAll(){return l.push(()=>s.root.findByPath(d.root+"**").then(t=>{0===t.length&&r.log("ERROR: Сцена не содержит ни одного элемента"),r.log("Длина результата "+t.length),t.forEach(t=>{void 0===o[t.name]&&(o[t.name]=[]),o[t.name].push(t)})})),this}get ready(){return n.a.addLoadableItem(d),null}}}static getObject(t){return this.getObjects(t)[0]}static getObjects(t){return o[t]}static setRoot(t){c=t}static get root(){return c}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));i(8);class a{constructor(t){this.entity=t.entity,this._active=!1}get active(){return this._active}set active(t){this._active=t}}},function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return r}));var a=i(11);i(24),i(5),i(0),i(8);i(19);const n=i(4);i(7);class s extends a.a{constructor(t){super(t),this._build=t,this._activationFunctions=t._activationFunctions,this._deactivationFunctions=t._deactivationFunctions,this._currentController=void 0}getController(t){let e=void 0;return this.entity.getComponents(s).forEach(i=>{i._build.constructor.name===t&&(e=i)}),e}switchController(t){let e=this.getController(t);this.entity.getComponents(s).forEach(t=>{t._deactivateController(),t._currentController=t}),e._activateController()}switchControllerByIndex(t){let e=this.entity.getComponents(s)[t];this.entity.getComponents(s).forEach(t=>{t._deactivateController(),t._currentController=t}),void 0===e&&n.log("ERROR: Сущность '"+this.entity.sceneObject.name+"' не имеет контроллера с индексом "+t),e._activateController(),this._currentController=e}_activateController(){this._activationFunctions.forEach(t=>t(this.entity))}_deactivateController(){this._deactivationFunctions.forEach(t=>t(this.entity))}}class r{constructor(){this._controllerBuilders=[],this._activationFunctions=[],this._deactivationFunctions=[],this._main=!1}_addControllerBuilder(t){this._controllerBuilders.push(t)}get parent(){return r}_attachToEntity(t){this.entity=t;t.componentBuilders.filter(t=>t.parent===r);return new s(this)}}},function(t,e,i){"use strict";i(8);var a=i(2);i(6);i(31),i(7);i.d(e,"a",(function(){return r}));const n=i(4);let s={};class r{static applyEffect(t,e,i){let a=r._getEffect(t);a._conflictingEffects.forEach(t=>{r.deactivateEffect(e,t)}),a.applyEffect(e,i)}static applyEffectGlobally(t,e){r._getEffect(t)._conflictingEffects.forEach(t=>{r.deactivateEffectGlobally(t)}),this.applyEffect(t,void 0,e)}static deactivateEffectGlobally(t){let e=r._getEffect(t);a.a.getCurrentPlayers().forEach(t=>{e.cancelEffect(t)}),e.cancelEffect(void 0)}static deactivateEffect(t,e){r._getEffect(e).cancelEffect(t)}static deactivateAll(){Object.keys(s).forEach(t=>{a.a.getCurrentPlayers().forEach(e=>{this._getEffect(t).cancelEffect(e)}),this._getEffect(t).cancelEffect()})}static isEffectActive(t,e){return this._getEffect(t).isActive(e)}static _getEffect(t){let e=s[t];return void 0===e&&n.log("ERROR: Эффект "+t+" не найден"),e}static _addEffect(t){s[t.name]=t}}},function(t,e){t.exports=require("Scene")},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));class a{static _initialize(){return new Promise.resolve}}},function(t,e,i){"use strict";i.r(e);var a=i(8),n=i(3),s=i(12),r=i(17),o=i(0);const l=i(19),c=i(7);i(4);var d=i(5),u=i(2),h=i(10);i.d(e,"default",(function(){return O}));const f=i(8).EntityBuilder,p=i(4),m=i(19),v=i(14);let g=[],y=[],b=void 0,E=!1,_=!0;(class{static onFacesCountChanged(t=500){let e=l.count.delayBy({milliseconds:t});return c.ne(l.count,e).onOn()}static getFaceControlX(t=0,e,i,a,n=50){e=o.a.verify(e),i=o.a.verify(void 0===i?e:i),a=o.a.verify(void 0===a?1:a);let s=l.face(t).cameraTransform.rotationZ.neg(),r=l.face(t).cameraTransform.rotationY,d=s.add(r).mul(a),u=c.fromRange(d,c.val(-.25),c.val(.25)).expSmooth(n);return o.a.toRangeFixed(u,e,i)}}).onFacesCountChanged().subscribe(()=>{y=g.slice(0,m.count.pinLastValue())});let S=[];class O extends a.default{constructor(t){super(t),this.build=t,this.faceId=0}spawn(){this.hasComponent(r.a)&&(this.stats.score=0),this.hasComponent(s.b)&&this.controller.switchControllerByIndex(0),super.spawn()}static get Builder(){let t;return t=new class extends f{constructor(){super(),this.type=void 0,this._disableWarnings=!1}setName(t){return this.type=t,S.push(t),this}disableWarnings(){return this._disableWarnings=!0,this}checkPlayersInSight(t=!0){return _=t,this}create(t){this.sceneObject=t;let e=new O(this);return g.push(e),e.faceId=g.indexOf(e),e}get ready(){void 0===this.type&&(this.type="player",S.push(this.type)),super.ready,!1===E&&(d.a.addLoadableItem(O),E=!0)}},t}static setFacetrackerFolder(t){b=t}static _initialize(){let t=[];if(void 0!==b)return d.a.addDeferredAsyncCallback(()=>new Promise((e,i)=>{v.root.findByPath(h.a.root+b+"/faceTracker*").then(a=>{0===a.length&&p.log("ERROR: Папка по адресу '"+b+"' не найдена или содержит 0 элементов"),a.length!==g.length&&(g.forEach(t=>p.log(t.sceneObjectName)),p.log("WARNING: Количество сущностей типа 'Player' и FaceTracker'ов не совпадает! Сущностей типа 'Player': "+g.length+" | FaceTracker'ов на сцене: "+a.length));let n=[];a.forEach((e,i)=>{O.getPlayerByFaceId(i).hasComponent(r.a)&&void 0!==O.getPlayerByFaceId(i).getComponent(r.a).score&&n.push(new Promise(i=>{e.findByPath("**/scoreObject*").then(a=>{0===a.length&&p.log("ERROR: Не найден объект типа 'scoreObject' внутри "+e.name+". Создайте объект с таким названием и вложите в "+e.name),a.forEach(a=>{a.findByPath("text_score*").then(n=>{0===n.length&&p.log("ERROR: Не найден объект типа 'text_score' внутри "+a.name+". Создайте объект с таким названием и вложите в "+a.name),t.push([e,n[0]]),i()})})})}))}),Promise.all(n).then(()=>{let i=g.filter(t=>t.hasComponent(r.a));i.length!==t.length&&p.log("WARNING: Количество сущностей типа 'Player' и scoreObject'ов не совпадает! Сущностей типа 'Player': "+i.length+" | scoreObject'ов на сцене: "+t.length),i.forEach((e,i)=>{void 0===e.stats.score||e.build._disableWarnings?p.log("WARNING: Игрок "+e.sceneObject.name+" не имеет scoreObject. Добавьте в билдер компонента 'StatsComponent' addScoreObject() или добавьте disableWarnings() для отключения этого сообщения"):(e.stats.onScoreChangedEvent.subscribe(()=>{t[i][1].text=e.stats.build.prefix+e.stats.score+e.stats.build.suffix,e._scoreObject=t[i][1]}),e.stats.score=0)}),e()}).catch(t=>{i(t)})}).catch(t=>{i(t)})})),Promise.resolve();p.log("ERROR: Папка с FaceTracker'ами игроков не установлена. Используйте Player.setFacetrackerFolder()")}static getPlayers(){return n.a._getEntities(S)}static getPlayerByFaceId(t){return g[t]}static getPlayersInSight(){return y=!0===_?g.slice(0,m.count.pinLastValue()):[g[0]],y}static getCurrentPlayers(){return u.a.getCurrentPlayers()}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i(11),n=i(1);i(4);class s extends a.a{constructor(t){super(t),this.build=t,void 0!==t.score&&(this.onScoreChangedEvent=t.onScoreChangedEvent,this.onScoreAddedEvent=t.onScoreAddedEvent,this.onScoreSubbedEvent=t.onScoreSubbedEvent,this.score=t.score,this.scoreMultiplier=1)}static get Builder(){return new r}get score(){return this._score}set score(t){this._score=t,this.onScoreChangedEvent.fire(this.entity)}addScore(t){this.score+=t*this.scoreMultiplier,this.onScoreAddedEvent.fire(this.entity)}subScore(t){this.score-=t,this.onScoreSubbedEvent.fire(this.entity)}}class r{constructor(){this.health=void 0,this.score=void 0}addScore(){let t=this;return new class{constructor(){t.onScoreChangedEvent=new n.a,t.onScoreAddedEvent=new n.a,t.onScoreSubbedEvent=new n.a,t.score=0,t.prefix="",t.suffix=""}addOnScoreChangedEvent(e){return t.onScoreChangedEvent.subscribe(e),this}addOnScoreAddedEvent(e){return t.onScoreAddedEvent.subscribe(e),this}addOnScoreSubbedEvent(e){return t.onScoreSubbedEvent.subscribe(e),this}setPrefix(e){return t.prefix=e,this}setSuffix(e){return t.suffix=e,this}get ready(){return t}}}_attachToEntity(t){return this.entity=t,new s(this)}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var a=i(9),n=i(1),s=i(6);i(0);const r=i(7),o=i(19);i(4);class l{static kiss(t){return r.and(r.and(o.face(t).mouth.leftCorner.x.add(o.face(t).mouth.rightCorner.x.mul(r.val(-1))).gt(r.val(-.04)),r.and(o.face(t).cameraTransform.rotationY.lt(r.val(a.a.Deg2Rad(30))),o.face(t).cameraTransform.rotationY.gt(r.val(-a.a.Deg2Rad(30))))),o.face(t).mouth.lowerLipCenter.z.add(o.face(t).mouth.upperLipCenter.z).gt(r.val(-.035)))}static openMouth(t){return o.face(t).mouth.openness.gt(r.val(.25))}static blink(t){return r.and(o.face(t).leftEye.openness.lt(r.val(.3)),o.face(t).rightEye.openness.lt(r.val(.3)))}static nod(t){let e=o.face(t).cameraTransform.rotationX.mul(r.val(180/Math.PI)).delayBy({milliseconds:.5}).sub(o.face(0).cameraTransform.rotationX.mul(r.val(180/Math.PI))),i=e.gt(r.val(4.3)),a=new n.a,l=!1;return i.onOn().subscribe(()=>{l||(l=!0,s.a.setTimeout(()=>l=!1,100),a.fire(e.sub(3.3).pinLastValue()))}),a}static negativeNod(t){let e=o.face(t).cameraTransform.rotationX.sub(r.val(.2)).mul(r.val(180/Math.PI)).delayBy({milliseconds:500}).sub(o.face(0).cameraTransform.rotationX.mul(r.val(180/Math.PI))),i=r.lt(o.face(t).cameraTransform.rotationX.sub(r.val(.1)),r.val(0)).ne(r.val(!0)),a=e.lt(r.val(-4.3)).and(i),l=new n.a,c=!1;return a.onOn().subscribe(()=>{c||(c=!0,s.a.setTimeout(()=>c=!1,100),l.fire(e.add(3.3).pinLastValue()))}),l}}},function(t,e){t.exports=require("FaceTracking")},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const a=i(21),n=i(4);i(7);class s{static get Builder(){return new class{duration(t){return this._duration=t,this}loopCount(t){return this._loopCount=t,this}mirror(t){return this._mirror=t,this}onAfterIteration(t){return this._onAfterIteration=t,this}onCompleted(t){return this._onCompleted=t,this}immediateStart(){return n.log("WARNING: Метод immediateStart() устарел. Используйте start()"),this._immediateStart=!0,this}start(){return this._immediateStart=!0,this}get ready(){let t=a.timeDriver({durationMilliseconds:this._duration,loopCount:void 0===this._loopCount?1:this._loopCount,mirror:void 0!==this._mirror&&this._mirror});return this._onAfterIteration&&t.onAfterIteration().subscribe(this._onAfterIteration),this._onCompleted&&t.onCompleted().subscribe(this._onCompleted),this._immediateStart&&t.start(),t}}}}},function(t,e){t.exports=require("Animation")},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var a=i(11);class n extends a.a{constructor(t){super(t),this.position=t.position,this.sceneObjectPosition=t.sceneObjectPosition,this.x=t.x,this.y=t.y,this.z=t.z}}},function(t,e,i){"use strict";var a=i(13),n=i(11),s=i(1),r=i(5),o=i(10),l=i(0);const c=i(4),d=i(29),u=i(14),h=i(7);let f,p=1,m=[],v=!1;class g{static play(t){!1===v&&this._getAudioObject(t).play()}static stop(t){!1===v&&this._getAudioObject(t).stop()}static loop(t){!1===v&&this._getAudioObject(t).loop()}static reset(t){!1===v&&this._getAudioObject(t).reset()}static setVolume(t){p=t,!1===v&&m.forEach(t=>t._updateVolume())}static setSpeakerFolder(t){f=t}static getSpeakerFolder(){return f}static getAudioObjects(){return m}static get Builder(){return new y}static _initialize(){return!0===v?Promise.resolve():void 0!==f?(r.a.addDeferredAsyncCallback(async()=>{await m.map(async t=>{t.playbackController=await d.getAudioPlaybackController(t.playbackControllerName),!0===t._initialLoop&&t.loop()}),await new Promise((t,e)=>{u.root.findByPath(o.a.root+f+"/*").then(t=>{0===t.length&&c.log("ERROR: Папка по адресу '"+f+"' не найдена или содержит 0 элементов"),t.length!==m.length&&c.log("ERROR: Количество Speaker ("+t.length+") на сцене не совпадает с количеством AudioObjects ("+m.length+")"),t.forEach(t=>{m.filter(e=>e.speakerName===t.name)[0].setSpeaker(t)})}),t()})}),Promise.resolve()):void c.log("ERROR: Папка с Speaker'ами не установлена. Используйте AudioManager.setSpeakerFolder()")}static _getAudioObject(t){let e=m.filter(e=>e.playbackControllerName===t)[0];return void 0===e&&c.log("ERROR: Аудиоконтроллер "+t+" не найден"),e}}class y{addAudioObject(t){return new b.Builder(this,t)}setVolume(t){return p=t,this}setSilentMode(t=!0){return v=t,!0===v&&c.log("WARNING: AudioManager will not play sounds in silent mode. Use Builder.setSilentMode(false)"),this}get ready(){r.a.addLoadableItem(g)}}class b{constructor(t){this.playbackControllerName=t._playbackControllerName,this.playbackController=void 0,this.volume=t._volume,this._initialLoop=t._loop,void 0!==t.speakerName?this.speakerName=t._speakerName:this.speakerName=this.playbackControllerName}play(){this.reset(),this.playbackController.setPlaying(!0)}stop(){this.reset(),this.playbackController.setLooping(!1),this.playbackController.setPlaying(!1)}reset(){this.playbackController.reset()}loop(){this.reset(),this.playbackController.setPlaying(!0),this.playbackController.setLooping(!0)}setSpeaker(t){this.speaker=t,this._updateVolume()}setVolume(t){this.volume=t,this._updateVolume()}_updateVolume(){this.speaker.volume=h.mul("number"==typeof this.volume?h.val(this.volume):this.volume,p)}static get Builder(){return E}}class E{constructor(t,e){this._audioManagerBuilder=t,this._playbackControllerName=e,this._volume=h.val(1),this._loop=!1}setSpeaker(t){return this._speakerName=t,this}setVolume(t=h.val(1)){return this._volume=l.a.verify(t),this}setLoop(){return!0===v?this:(this._loop=!0,this)}get ready(){return m.push(new b(this)),this._audioManagerBuilder}}i.d(e,"b",(function(){return O})),i.d(e,"a",(function(){return C}));const _=i(4),S=i(7);class O extends n.a{constructor(t){super(t),this.onCollisionEnter=new s.a,this.onCollisionExit=new s.a,this.currentCollisions=[],this.size={x:void 0,y:void 0,z:void 0},this._debug=t._debug,this.triggerCondition=S.val(!0),this._fireOnGameStopped=t._fireOnGameStopped}_addTarget(){}}class C{constructor(){this._onCollisionTargets=[]}addTriggerCondition(t){return this.triggerCondition=t,this}fireOnGameStopped(){return this._fireOnGameStopped=!0,this}initialFire(){return this._initialFire=!0,this}debug(){return this._debug=!0,this}onCollisionWithTypes(...t){return _.log("WARNING: Метод onCollisionWithTypes() устерел. Используйте onCollisionWithType()"),this.onCollisionWithType(...t)}onCollisionWithType(...t){if(0===t.length)return void _.log("WARNING: Trying to set ColliderComponent.onCollisionWithType() event with UNDEFINED target types");let e=this;let i=new class{constructor(){this._targetTypes=t,this._callbacksOnEnter=[],this._callbackOnExit=[],this._callbackConditions=[],this._reactiveCallbackConditions=[]}onEnter(){return new n("enter")}onExit(){return new n("exit")}addCallbackCondition(t){return this._callbackConditions.push(t),this}addReactiveCallbackCondition(t){return this._reactiveCallbackConditions.push(t),this}requireEffect(t){return this._callbackConditions.push((e,i)=>a.a.isEffectActive(t,e)),this}requireEffectOnTarget(t){return this._callbackConditions.push((e,i)=>a.a.isEffectActive(t,i)),this}get ready(){return this._targetTypes.forEach(t=>{e._onCollisionTargets.push([t,this._callbacksOnEnter,this._callbackOnExit,this._callbackConditions,this._reactiveCallbackConditions])}),e}};class n{constructor(t){this._callbacks="enter"===t?i._callbacksOnEnter:i._callbackOnExit}doAction(t=function(){}){return this._callbacks.push(t),this}applyEffectGlobally(t,e){return this._callbacks.push(()=>a.a.applyEffectGlobally(t,e)),this}applyEffect(t,e){return this._callbacks.push((i,n)=>a.a.applyEffect(t,i,e)),this}applyEffectTarget(t,e){return _.log("WARNING: Метод applyEffectTarget() устарел. Используйте applyEffectOnTarget()"),this._callbacks.push((i,n)=>a.a.applyEffect(t,n,e)),this}applyEffectOnTarget(t,e){return this._callbacks.push((i,n)=>a.a.applyEffect(t,n,e)),this}addHealth(t=1){return this._callbacks.push((e,i)=>e.addHealth(t)),this}addHealthOnTarget(t=1){return this._callbacks.push((e,i)=>i.addHealth(t)),this}addScore(t=1){return this._callbacks.push((e,i)=>e.stats.addScore(t)),this}addScoreOnTarget(t=1){return this._callbacks.push((e,i)=>i.stats.addScore(t)),this}playSound(t){return this._callbacks.push(()=>g.play(t)),this}die(t=null){return this._callbacks.push((e,i)=>{e.kill(i,t)}),this}killTarget(t){return this._callbacks.push((e,i)=>{i.kill(e,t)}),this}damage(t=1){return this._callbacks.push((e,i)=>{e.damage(t,i)}),this}damageTarget(t=1){return this._callbacks.push((e,i)=>{i.damage(t,e)}),this}get ready(){return i}}return i}}},function(t,e,i){"use strict";i(11);var a=i(22),n=i(12),s=i(17),r=i(23);i(20),i(0),i(18),i(1),i(6);i(21),i(19),i(14),i(7),i(25),i(4);n.b;i.d(e,"a",(function(){return l}));const o=i(4);class l{attachComponents(t){this.componentBuilders=t;try{this.components=this.componentBuilders.map(t=>t._attachToEntity(this))}catch(t){o.log("ERROR: Невозможно прикрепить компоненты к сущности "+this.sceneObject.name),o.log(t.message)}this.transform=this.getComponent(a.a),this.collider=this.getComponent(r.b),this.controller=this.getComponent(n.b),this.runnerController=this.getComponent(n.b),this.stats=this.getComponent(s.a)}addComponent(t){this.components.push(t)}getComponent(t){return this.getComponents(t)[0]}getComponents(t){return this.components.filter(e=>e instanceof t)}hasComponent(t){return this.components.filter(e=>e instanceof t).length>0}}},function(t,e){t.exports=require("TouchGestures")},function(t,e){Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),a=i.length>>>0;if(0===a)return!1;var n,s,r=0|e,o=Math.max(r>=0?r:a-Math.abs(r),0);for(;o<a;){if((n=i[o])===(s=t)||"number"==typeof n&&"number"==typeof s&&isNaN(n)&&isNaN(s))return!0;o++}return!1}}),Object.values||(Object.values=function(t){return Object.keys(t).map(e=>t[e])})},function(t,e){t.exports=require("Textures")},function(t,e){t.exports=require("CameraInfo")},function(t,e){t.exports=require("Audio")},function(t,e){t.exports=require("Materials")},function(t,e){t.exports=require("Patches")},function(t,e){t.exports=require("Persistence")},function(t,e,i){"use strict";i.r(e);i(26);var a=i(5),n=i(10),s=i(3),r=i(8),o=i(16),l=i(22),c=i(0);const d=i(7);class u extends l.a{constructor(t){super(t)}static get Builder(){return new class{_attachToEntity(t){this.entity=t;let e=new l.a(this);return Object.defineProperty(e,"sceneObjectPosition",{get:()=>t.sceneObject.transform.position,set:e=>{t.sceneObject.transform.position=e}}),Object.defineProperty(e,"position",{get:()=>d.vector(e.x,e.y,e.z),set:t=>{e.x=t.x,e.y=t.y,e.z=t.z}}),Object.defineProperty(e,"x",{get:()=>t.sceneObject.transform.x,set:e=>{t.sceneObject.transform.x=c.a.verify(e)}}),Object.defineProperty(e,"y",{get:()=>t.sceneObject.transform.y,set:e=>{t.sceneObject.transform.y=c.a.verify(e)}}),Object.defineProperty(e,"z",{get:()=>t.sceneObject.transform.z,set:e=>{t.sceneObject.transform.z=c.a.verify(e)}}),e}}}}var h=i(23),f=i(2);const p=i(7),m=i(4);class v extends h.b{constructor(t){super(t),this.entity=t.entity,this.sizeX=void 0!==t.sizeX?c.a.verify(t.sizeX).mul(this.entity.sceneObject.transform.scaleX):void 0,this.sizeY=void 0!==t.sizeY?c.a.verify(t.sizeY).mul(this.entity.sceneObject.transform.scaleY):void 0,this.sizeZ=void 0!==t.sizeZ?c.a.verify(t.sizeZ).mul(this.entity.sceneObject.transform.scaleZ):void 0,this.size={x:void 0!==t.sizeX?c.a.verify(t.sizeX).mul(this.entity.sceneObject.transform.scaleX):void 0,y:void 0!==t.sizeY?c.a.verify(t.sizeY).mul(this.entity.sceneObject.transform.scaleY):void 0,z:void 0!==t.sizeZ?c.a.verify(t.sizeZ).mul(this.entity.sceneObject.transform.scaleZ):void 0},this.centerPositionOffset=void 0!==t.centerPositionOffset?{x:c.a.verify(t.centerPositionOffset.x),y:c.a.verify(t.centerPositionOffset.y),z:c.a.verify(t.centerPositionOffset.z)}:{x:p.val(0),y:p.val(0),z:p.val(0)}}_addTarget(t,e=[],i=[],a=[],n=[]){super._addTarget(),void 0===t.collider&&m.log("ERROR: Попытка настроить коллизию с сущностью без коллайдера: '"+t.sceneObject.name+"'");let s=[this.triggerCondition];this.sizeX&&t.collider.sizeX&&s.push(g("x",this,t.collider)),this.sizeY&&t.collider.sizeY&&s.push(g("y",this,t.collider)),this.sizeZ&&t.collider.sizeZ&&s.push(g("z",this,t.collider)),s.push(...n.map(e=>e(this.entity,t)));let r=p.andList(s),o=()=>(!0===this._fireOnGameStopped||!0===f.a.inProgress)&&!0===this.entity.active&&!0===t.active&&!0==!this.entity.spawnAnimationActive&&!0==!t.spawnAnimationActive&&!0==!this.entity.deathAnimationActive&&!0==!t.deathAnimationActive&&a.map(e=>e(this.entity,t)).every(t=>!0===t);return r.onOn().subscribe(()=>{o()&&(this.currentCollisions.includes(t.collider)||this.currentCollisions.push(t.collider),t.collider.currentCollisions.includes(this)||t.collider.currentCollisions.push(this),e.forEach(e=>e(this.entity,t)))}),r.onOff().subscribe(()=>{this.currentCollisions.includes(t.collider)&&this.currentCollisions.splice(this.currentCollisions.indexOf(t.collider),1),t.collider.currentCollisions.includes(this)&&t.collider.currentCollisions.splice(t.collider.currentCollisions.indexOf(this),1),o()&&i.forEach(e=>e(this.entity,t))}),!0===this._debug&&(this.sizeX&&t.collider.sizeX&&m.watch(this.entity.sceneObject.name+" collision(x) with "+t.sceneObject.name+": ",g("x",this,t.collider)),this.sizeY&&t.collider.sizeY&&m.watch(this.entity.sceneObject.name+" collision(y) with "+t.sceneObject.name+": ",g("y",this,t.collider)),this.sizeZ&&t.collider.sizeZ&&m.watch(this.entity.sceneObject.name+" collision(z) with "+t.sceneObject.name+": ",g("x",this,t.collider))),r}static get Builder(){class t extends h.a{addX(t){return this.sizeX=t,this}addY(t){return this.sizeY=t,this}addZ(t){return this.sizeZ=t,this}defineCenterOffset(t){return this.centerPositionOffset=t,this}_attachToEntity(t){this.entity=t,void 0===this.triggerCondition&&(this.triggerCondition=p.val(!0)),void 0===this._fireOnGameStopped&&(this._fireOnGameStopped=!1),void 0===this._debug&&(this._debug=!1);let e=new v(this);return e.triggerCondition=this.triggerCondition,this._onCollisionTargets.length>0&&a.a.addDeferredCallback(()=>{this._onCollisionTargets.forEach(i=>{0===s.a._getEntities([i[0]]).length&&m.log("WARNING: Не найдена ни одна сущность типа '"+i[0]+"'. Невозможно настроить коллизию между '"+t.type+"' и '"+i[0]+"'."),s.a._getEntities([i[0]]).forEach(t=>{e._addTarget(t,i[1],i[2],i[3],i[4])})})}),e}}return new t}}function g(t,e,i){return a=e.entity.transform[t].add(e.centerPositionOffset[t]),n=e.size[t],s=i.entity.transform[t].add(i.centerPositionOffset[t]),r=i.size[t],p.and(a.add(n.add(r).div(p.val(2))).gt(s),a.sub(n.add(r).div(p.val(2))).lt(s));var a,n,s,r}const y=i(32),b=i(4);let E={};class _{static setDefaultValues(t,e=!1){return E=t,new Promise((i,a)=>{_._loadData().then(a=>{null===a&&(a={}),Object.keys(t).forEach((function(i){if(!0===a.hasOwnProperty(i)&&!0===e)a[i]=t[i];else{if(!0===a.hasOwnProperty(i)&&!1===e)return;a[i]=t[i]}})),E=a,_._saveData(a).then(i)},()=>{let e={};Object.keys(t).forEach((function(i){e[i]=t[i]})),_._saveData(e).then(i)})})}static setKeyValue(t,e){return E[t]=e,_._loadData().then(i=>{i[t]=e,_._saveData(i)},i=>{_._saveData({key:e}).then(()=>_.setKeyValue(t,e))})}static loadKeyValue(t){return new Promise((e,i)=>{_._loadData().then(i=>e(i[t]))})}static getKeyValue(t){return E[t]}static _saveData(t){return S(),y.userScope.set("saveData",t)}static _loadData(){return S(),y.userScope.get("saveData")}static getData(){return E}static removeData(){return E={},y.userScope.remove("saveData")}}function S(){try{y.userScope.get("saveData")}catch(t){b.log("ERROR: Для работы аддона 'SaveManager' необходимо добавить слово 'saveData' в список whitelisted keys в разделе Capabilities > Persistence")}}var O=i(6),C=i(9),w=i(18),k=i(1),R=i(20);const P=i(21);i(4);class A{constructor(t,e,i,a,n){this.player=t,this.state=this.States.grounded,this.world=n,this.startGround=a,this.outOfScreenGround=-.33,this.ground=this.startGround,this.jumpHeight=e,this.gravity=i,this.onJumpedEvent=new k.a,this.onLandedEvent=new k.a,this.onGroundedEvent=new k.a,this.jumpDriver=void 0,this.fallDriver=void 0,this.active=!0,this.player.onDeathEvent.subscribe(()=>{this.setActive(!1)})}setActive(t){this.active=t,void 0!==this.jumpDriver&&this.jumpDriver.stop(),void 0!==this.fallDriver&&this.fallDriver.stop()}jump(){if(!1!==this.active&&f.a.gameState===f.a.GameStates.IN_PROGRESS)switch(this.state){case this.States.grounded:this._buildJump()}}escapeFromCollider(t){if(!1!==this.active)switch(this.state){case this.States.grounded:this.ground=this.fallGround,this._buildFall();break;case this.States.inJump:case this.States.inFall:this.ground=this.fallGround}}landOnCollider(t){if(!1!==this.active)switch(this.state){case this.States.grounded:break;case this.States.inJump:this.ground=t.entity.transform.y.add(t.size.y.div(2)).add(t.centerPositionOffset.y).pinLastValue(),this.onLandedEvent.fire(t);break;case this.States.inFall:this.ground=t.entity.transform.y.add(t.size.y.div(2)).add(t.centerPositionOffset.y).pinLastValue(),this.onLandedEvent.fire(t),this._buildLanding()}}_buildJump(){return this.state=this.States.inJump,void 0!==this.jumpDriver&&this.jumpDriver.stop(),this.jumpDriver=this._buildMoveDriver(this.player.transform.y.pinLastValue(),this.player.transform.y.pinLastValue()+this.jumpHeight.pinLastValue(),this.Situations.jump),this.jumpDriver.onAfterIteration().subscribe(()=>{this._buildFall()}),this.onJumpedEvent.fire(),this.jumpDriver}_buildFall(){return this.state=this.States.inFall,void 0!==this.fallDriver&&this.fallDriver.stop(),this.fallDriver=this._buildMoveDriver(this.player.transform.y.pinLastValue(),this.fallGround+this.player.collider.size.y.div(2).add(this.player.collider.centerPositionOffset.y).pinLastValue(),this.Situations.fall),this.fallDriver.onAfterIteration().subscribe(()=>{this.player.kill("out_of_screen")}),this.fallDriver}_buildLanding(){return this.state=this.States.inFall,void 0!==this.fallDriver&&this.fallDriver.stop(),this.fallDriver=this._buildMoveDriver(this.player.transform.y.pinLastValue(),this.ground+this.player.collider.size.y.div(2).add(this.player.collider.centerPositionOffset.y).pinLastValue(),this.Situations.fall),this.fallDriver.onAfterIteration().subscribe(()=>{this.state=this.States.grounded,this.onGroundedEvent.fire()}),this.fallDriver}_buildMoveDriver(t,e,i){let a=Math.abs(e-t)/this.gravity.pinLastValue();a<30&&(a=30);let n,s=R.a.Builder.duration(a).ready;switch(i){case this.Situations.jump:n=P.samplers.easeOutCubic;break;case this.Situations.fall:n=P.samplers.easeInCubic;break;case this.Situations.interruptedFall:n=P.samplers.easeInQuad;break;case this.Situations.landing:n=P.samplers.linear}return this.player.transform.y=P.animate(s,n(t,e)),s.start(),s}get fallGround(){return 0-this.world.transform.y.pinLastValue()+this.outOfScreenGround}get Situations(){return new class{get jump(){return"jump"}get fall(){return"fall"}get interruptedFall(){return"interruptedFall"}get landing(){return"landing"}}}get States(){return new class{get inJump(){return"inJump"}get inFall(){return"inFall"}get grounded(){return"grounded"}}}}const D=i(14),T=i(4);const j=i(14),x=i(7),I=i(19),G=i(4),B=i(25),N=i(21);G.log("script >> Loading, please wait...");let z,L,V,F=(new Date).getTime(),H={},M={entities:{},platforms:{},player:{}},W={};s.a.setEntityFolder("entities"),o.default.setFacetrackerFolder("faceTrackers"),n.a.Builder.loadFirst("anchor").load("world","entities").ready,r.default.Builder.abstract().setName("object").addComponent(u.Builder).addOnStateChangedEvent(t=>t.sceneObject.hidden=x.val(!t.active)).addOnDeathEvent(t=>{void 0!==t.moveDriver&&null!==t.moveDriver&&(t.moveDriver.stop(),t.moveDriver=null),t.transform.position=x.point(1,1,0)}).ready;let Y={blocks:{events:void 0,states:void 0},events:{onGameStarted:"I_OGS",onGameOver:"I_OGO",onJumped:"I_OJ0",onLanded:"I_OL0",onDamaged:"I_OD0",onDied:"I_ODI",onScoreAdded:"I_OSA",onScoreSubtracted:"I_OSS"},states:{firstLaunch:"I_FL",inProgress:"I_IP",paused:"I_P0",gameOver:"I_GO"},fireEvent:t=>Y.blocks.events.setPulse(t,x.once()),setState:(t,e)=>Y.blocks.states.setBoolean(t,e)};let J,q={block:void 0,autoJump:void 0,jumpOnTap:void 0,jumpOnBlink:void 0,jumpOnNod:void 0,customJump:void 0,sensitivity:void 0,rangeHorizontal:void 0,smoothing:void 0};let X={block:void 0,jumpHeight:void 0,gravity:void 0,viewColliders:void 0,colliderSize:void 0,colliderCenterOffset:void 0};async function Z(){let t=(await j.root.findByPath("Device/SETTINGS/Loading Settings"))[0],e=await t.outputs.getPulseOrFallback("Custom Start Event",x.once()),i=await t.outputs.getPulseOrFallback("Custom End Event",x.once());Y.setState(Y.states.firstLaunch,!0);let a=o.default.getPlayers()[0],r=!0;z=n.a.getObject("world");let l=x.val(-.14).add(a.collider.size.y.div(2)).add(X.colliderCenterOffset.y).neg().pinLastValue();L=new A(a,X.jumpHeight,X.gravity.div(27e3),-.14,z),V=new $,s.a.getEntities(...Object.keys(M.platforms)).forEach(t=>{t.sceneObject.worldTransform.y.lt(-.28).onOn().subscribe(async()=>{if(!0===t.active){t.sceneObject.transform.position=z.transform.toSignal().inverse().position,t.kill("out_of_screen"),await tt(30);let e=C.a.chooseWeighted(M.platforms),i=s.a.getInactiveEntities(e);if(i.length<=0){K(e);let t=s.a.getInactiveEntities(...Object.keys(M.platforms));return t.length<=0?void G.log("ERROR: Too few instances of platform types at all. Platforms movement can look glitchy. Add more platform type instances"):void t[C.a.GetRandomInt(0,t.length)].spawn()}i[C.a.GetRandomInt(0,i.length)].spawn()}})}),L.onGroundedEvent.subscribe(()=>{!0===q.autoJump.pinLastValue()&&L.jump()});let d=async()=>{let t=s.a.getInactiveEntities(...Object.keys(M.platforms)).map(t=>({value:t,sort:Math.random()})).sort((t,e)=>t.sort-e.sort).map(({value:t})=>t),e=t.find(t=>!1===H[t.type].moveable.pinLastValue());if(t.splice(t.indexOf(e),1),void 0===e)return void G.log("ERROR: No platform type has 'Moveable' param set to 'false'. Add at least one platform type with 'Moveable' param set to 'false'");e.collider.centerPositionOffset.y.sub(e.collider.size.y.div(2)).pinLastValue();e.spawn(),e.transform.x=x.val(0),await tt(30),t.length<12&&G.log("ERROR: Platform type instances count must be at least 12. Add more instances");for(let e of t.slice(0,12))e.spawn(),await tt(30);z.transform.y=x.val(0),Q.push(()=>{},()=>{z.transform.y=x.val(.11).sub(a.sceneObject.transform.y.add(l)).min(z.transform.y.history(-1).at(0).sub(l)).add(l).expSmooth(100);let t=e.transform.y.add(e.collider.size.y.div(2)).add(e.collider.centerPositionOffset.y).add(a.collider.size.y.div(2)).sub(X.colliderCenterOffset.y);a.transform.y=t,a.transform.x=x.val(0),a.sceneObject.hidden=x.val(!1),L.state=L.States.grounded,L.startGround=t.sub(X.colliderSize.y.div(2)).sub(X.colliderCenterOffset.y).pinLastValue()},()=>{L.setActive(!0)})};await d(),L.onJumpedEvent.subscribe(()=>Y.fireEvent(Y.events.onJumped)),L.onGroundedEvent.subscribe(()=>Y.fireEvent(Y.events.onLanded)),f.a.onGameStartedEvent.subscribe(()=>{Y.setState(Y.states.inProgress,!0),Y.setState(Y.states.gameOver,!1),Y.setState(Y.states.firstLaunch,!1),Y.setState(Y.states.paused,!1)}),f.a.onGamePausedEvent.subscribe(()=>{Y.setState(Y.states.paused,!0),Y.setState(Y.states.gameOver,!1)}),f.a.onGameOverEvent.subscribe(()=>{Y.setState(Y.states.gameOver,!0),Y.setState(Y.states.inProgress,!1)}),f.a.onGameStartedEvent.subscribe(()=>{!1===r||(r=!1),O.a.setTimeout(()=>{L.jump(),O.a.setTimeout(()=>function(t){let e=I.face(0).cameraTransform.rotationZ.neg(),i=I.face(0).cameraTransform.rotationY,a=e.add(i).mul(q.sensitivity),n=x.fromRange(a,x.val(-.25),x.val(.25)).expSmooth(q.smoothing.pinLastValue());t.transform.x=c.a.toRangeFixed(n,q.rangeHorizontal.neg(),q.rangeHorizontal)}(a),100)},150),Y.fireEvent(Y.events.onGameStarted),Y.fireEvent(Y.events.onLanded)}),f.a.onGameOverEvent.subscribe(()=>{s.a.getActiveEntities(...Object.keys(M.platforms)).forEach(t=>t.kill()),s.a.getActiveEntities(...Object.keys(M.entities)).forEach(t=>t.kill()),z.transform.y=x.val(0),L.setActive(!1),a.transform.x=x.val(0),Y.fireEvent(Y.events.onGameOver)});let u=!1;e.subscribe(async()=>{f.a.gameState===f.a.GameStates.FIRST_LAUNCH||!0===u?(f.a.startGame(),u=!1):f.a.gameState===f.a.GameStates.FINISHED&&!1===u&&(f.a.pauseGame(),await d(),u=!0,V.reset())}),i.subscribe(()=>{f.a.gameState===f.a.GameStates.IN_PROGRESS&&a.kill("custom_end_event")}),G.log("script >> Loaded in "+(((new Date).getTime()-F)/1e3).toFixed(2)+"s // created at savij.ar @ instagram.com/rokkoeffe // template version: 1.4.1"),G.log("Check out more high-quality templates at 'gumroad.com/rokkoeffe'. Have any questions? Join our telegram chat: 't.me/sparkarchat'")}function U(t,e){t.hidden=e.viewColliders.not(),t.transform.position=x.point(e.colliderCenterOffset.x,e.colliderCenterOffset.y,e.colliderCenterOffset.z),t.transform.scale=x.vector(1,1,1),t.transform.rotationX=x.val(0),t.transform.rotationY=x.val(0),t.transform.rotationZ=x.val(0),t.inputs.setVector("Scale",e.colliderSize)}function K(t){G.log("=========================================================="),G.log("WARNING: Too few instances of type '"+t+"'. Add more instances"),G.log("WARNING: Overall: "+s.a.getEntities(t).length+", active: "+s.a.getActiveEntities(t).length+", inactive: "+s.a.getInactiveEntities(t).length),G.log("Active: "+s.a.getActiveEntities(t).map(t=>t.sceneObject.name)),G.log("Inactive: "+s.a.getInactiveEntities(t).map(t=>t.sceneObject.name)),G.log("==========================================================")}(new class{verifyCopyright(){return new Promise(async(t,e)=>{if(!1===(void 0!==(await D.root.findByPath(this.decipher("idi_nahui_cyka")("4b6a79666c6a204c474a4c442f4e5a5b474a415b464c465b562f474a5d4a207b67667c2f7b6a627f636e7b6a2f6c6e612f6d6a2f6d607a68677b")))[0]&&void 0!==(await D.root.findByPath(this.decipher("idi_nahui_cyka")("4b6a79666c6a204c474a4c442f4e5a5b474a415b464c465b562f474a5d4a20606163762f697d60622f62762f687a627d606e6b35")))[0]&&void 0!==(await D.root.findByPath(this.decipher("idi_nahui_cyka")("4b6a79666c6a204c474a4c442f4e5a5b474a415b464c465b562f474a5d4a20687a627d606e6b216c60622f7d606464606a69696a")))[0]&&void 0!==(await D.root.findByPath(this.decipher("idi_nahui_cyka")("4b6a79666c6a204c474a4c442f4e5a5b474a415b464c465b562f474a5d4a2066617c7b6e687d6e622f4f7d606464606a69696a")))[0]&&void 0!==(await D.root.findByPath(this.decipher("idi_nahui_cyka")("4b6a79666c6a204c474a4c442f4e5a5b474a415b464c465b562f474a5d4a2066617c7b6e687d6e622f4f7c6e796665216e7d")))[0])){for(let t=0;t<5;t++)T.log(this.decipher("idi_nahui_cyka")("4a5d5d405d352f5b67667c2f7f7d60656a6c7b2f626668677b2f676e796a2f6d6a6a612f7c7b60636a612f6e616b2f7d6a7c60636b212f46692f76607a2f6b666b61287b2f6d7a762f667b2f697d60622f28687a627d606e6b216c6062207d606464606a69696a28232f6c60617b6e6c7b2f626a2f60612f5b6a636a687d6e62352f287b21626a207d606464606a69696a28"));e()}t()})}cipher(t){const e=t=>t.split("").map(t=>t.charCodeAt(0)),i=t=>("0"+Number(t).toString(16)).substr(-2),a=i=>e(t).reduce((t,e)=>t^e,i);return t=>t.split("").map(e).map(a).map(i).join("")}decipher(t){const e=e=>{return(i=t,i.split("").map(t=>t.charCodeAt(0))).reduce((t,e)=>t^e,e);var i};return t=>t.match(/.{1,2}/g).map(t=>parseInt(t,16)).map(e).map(t=>String.fromCharCode(t)).join("")}}).verifyCopyright().then(()=>{j.root.findByPath("Device/SETTINGS/Loading Settings").then(t=>{t[0].outputs.getBoolean("Load Script").then(async t=>{let e=!1,i=async()=>{await _.setDefaultValues({best_score:0}),await async function(){try{Y.blocks.events=(await j.root.findByPath("Device/EVENT SYSTEM/Events"))[0].inputs,Y.blocks.states=(await j.root.findByPath("Device/EVENT SYSTEM/States"))[0].inputs}catch(t){G.log("ERROR: Can't find 'Device/EVENT SYSTEM/Events'. Place this block at the given address"),G.log("ERROR: Can't find 'Device/EVENT SYSTEM/States'. Place this block at the given address")}}(),await async function(){q.block=(await j.root.findByPath("Device/SETTINGS/Controls Settings"))[0],q.autoJump=await q.block.outputs.getBoolean("Auto Jump"),q.jumpOnTap=await q.block.outputs.getBoolean("Jump On Tap"),q.jumpOnBlink=await q.block.outputs.getBoolean("Jump On Blink"),q.jumpOnNod=await q.block.outputs.getBoolean("Jump On Nod"),q.customJump=await q.block.outputs.getPulseOrFallback("Custom Jump",x.once()),q.sensitivity=await q.block.outputs.getScalar("Sensitivity"),q.rangeHorizontal=await q.block.outputs.getScalar("Range Horizontal"),q.smoothing=await q.block.outputs.getScalar("Smoothing");let t=()=>{f.a.gameState===f.a.GameStates.IN_PROGRESS&&L.jump()};q.customJump.subscribe(()=>t()),x.and(q.jumpOnBlink,w.a.blink(0)).onOn().subscribe(()=>t()),B.onTap().subscribe(()=>{!0===q.jumpOnTap.pinLastValue()&&t()}),w.a.nod(0).subscribe(()=>{!0===q.jumpOnNod.pinLastValue()&&t()})}(),await async function(){let t=await j.root.findByPath(s.a.getEntityFolder()+"/*"),e=[];await Promise.all(t.map(async t=>{try{await t.outputs.getScalar("Jump Height");e.push(t)}catch(t){}})),e.length>1&&G.log("ERROR: Only one 'Player Type' block is allowed. Remove other player types and let only one remain"),e.length<=0&&G.log("ERROR: At least one 'Player Type' block is required. Add 'Player Type' block to 'entities' folder");try{X.block=e[0]}catch(t){G.log("ERROR: Can't find 'entities/player' block. Place this block at the given address")}M.player[e[0].name]=x.val(0),await Promise.all([X.block.outputs.getScalar("Jump Height").then(t=>X.jumpHeight=t),X.block.outputs.getScalar("Gravity").then(t=>X.gravity=t),X.block.outputs.getBoolean("View Colliders").then(t=>X.viewColliders=t),X.block.outputs.getVector("Collider Size").then(t=>X.colliderSize=t),X.block.outputs.getVector("Collider Center Offset").then(t=>X.colliderCenterOffset=t)])}(),await async function(){let t=await j.root.findByPath(s.a.getEntityFolder()+"/*"),e=[];await Promise.all(t.map(async t=>{try{await t.outputs.getBoolean("Die");e.push(t)}catch(t){}}));let i=e.map(async t=>{let e=t;if(null==e)return void G.log("ERROR: Entity type '"+t.name+"' isn't created from 'Entity Type' block. Go Add > Entity Type instead of creating nullObject");let i={block:e,spawnChance:await e.outputs.getScalar("Spawn Chance"),viewSpawnPositionOffset:await e.outputs.getBoolean("View Spawn Position Offset"),spawnPositionOffset:await e.outputs.getVector("Spawn Position Offset"),viewColliders:await e.outputs.getBoolean("View Colliders"),colliderSize:await e.outputs.getVector("Collider Size"),colliderCenterOffset:await e.outputs.getVector("Collider Center Offset"),die:await e.outputs.getBoolean("Die"),killPlayer:await e.outputs.getBoolean("Kill Player"),changeScore:await e.outputs.getScalar("Change Score"),onCollision:await e.outputs.getPulseOrFallback("On Collision",x.once())};M.entities[t.name]=i.spawnChance,r.default.Builder.extends("object").setName(t.name).addOnSpawnEvent(t=>{}).addOnDeathEvent((t,e)=>{null!==t.platform&&void 0!==t.platform&&(t.platform.entity=null,t.platform=null)}).addComponent(v.Builder.addX(i.colliderSize.x).addY(i.colliderSize.y).defineCenterOffset(i.colliderCenterOffset).onCollisionWithType(...Object.keys(M.player)).onEnter().doAction(t=>{e.inputs.setPulse("(savij.ar)",x.once()),!0===i.die.pinLastValue()&&t.kill("type settings"),!0===i.killPlayer.pinLastValue()&&o.default.getCurrentPlayers()[0].kill("type settings"),0!=i.changeScore.pinLastValue()&&V.changeScore(i.changeScore.pinLastValue())}).ready.ready).ready,W[t.name]={spawnChance:i.spawnChance,spawnPositionOffset:i.spawnPositionOffset};let a=await j.root.findByPath(s.a.getEntityFolder()+"/"+t.name+"/*/block/Collider Drawer");a.length<=0&&!0===i.viewColliders.pinLastValue()?(G.log("WARNING: No entity of type '"+t.name+"' has 'Collider Drawer' block. You will not be able to view colliders of this entity instances"),G.log("To fix this, add 'Collider Drawer' block inside every main 'block' of each entity"),G.log("To HIDE this warning, turn 'View Colliders' setting of this type to 'false'"),G.log("This is optional. If the project is about to export, you can safely remove 'Collider Drawer' blocks")):a.length<=0&&!1===i.viewColliders.pinLastValue()?i.viewColliders.onOn().subscribe(()=>{G.log("WARNING: Add 'Collider Drawer' block to each entity instance and press 'Reload' button to view colliders")}):a.forEach(t=>{U(t,i)}),i.block.transform.position=x.point(0,0,0),i.block.transform.scale=x.vector(1,1,1),i.block.transform.rotationX=x.val(0),i.block.transform.rotationY=x.val(0),i.block.transform.rotationZ=x.val(0)});await Promise.all(i)}(),await async function(){let t=await j.root.findByPath(s.a.getEntityFolder()+"/*"),e=[];await Promise.all(t.map(async t=>{try{await t.outputs.getBoolean("Moveable");e.push(t)}catch(t){}})),await Promise.all(e.map(async t=>{let e=t;if(null==e)return void G.log("ERROR: Entity type '"+t.name+"' isn't created from 'Entity Type' block. Go Add > Entity Type instead of creating nullObject");let i={block:e,spawnChance:await e.outputs.getScalar("Spawn Chance"),moveable:await e.outputs.getBoolean("Moveable"),movingSpeed:await e.outputs.getScalar("Moving Speed"),viewColliders:await e.outputs.getBoolean("View Colliders"),colliderSize:await e.outputs.getVector("Collider Size"),colliderCenterOffset:await e.outputs.getVector("Collider Center Offset"),minDistanceBetween:await e.outputs.getScalar("Min Distance Between"),maxDistanceBetween:await e.outputs.getScalar("Max Distance Between"),changeScore:await e.outputs.getScalar("Change Score")};M.platforms[t.name]=i.spawnChance,H[t.name]={moveable:i.moveable,minDistanceBetween:i.minDistanceBetween,maxDistanceBetween:i.minDistanceBetween,movingSpeed:i.movingSpeed};let a=v.Builder.addX(.3).addY(i.colliderSize.y).defineCenterOffset(i.colliderCenterOffset).onCollisionWithType(...Object.keys(M.player)).onExit().doAction((t,e)=>{if(!1===t.scoreGiven||void 0===t.scoreGiven){let a=e.transform.y.sub(e.collider.size.y.div(2)).add(e.collider.centerPositionOffset.y).pinLastValue();a+=.02,a>t.transform.y.add(t.collider.size.y.div(2)).add(t.collider.centerPositionOffset.y).pinLastValue()&&0!==i.changeScore.pinLastValue()&&(V.changeScore(i.changeScore.pinLastValue()),t.scoreGiven=!0)}}).ready.ready;r.default.Builder.extends("object").setName(t.name).addOnSpawnEvent(t=>{}).addOnDeathEvent((t,e)=>{}).addComponent(v.Builder.addX(i.colliderSize.x).addY(i.colliderSize.y).defineCenterOffset(i.colliderCenterOffset)).addComponent(a).addOnSpawnEvent(t=>{if(!0===i.moveable.pinLastValue()){let e=i.movingSpeed.pinLastValue()*Math.pow(10,-4),a=i=>{let n=i?C.a.GetRandomFloat(-.08,.08):t.transform.x.pinLastValue(),s=i?0===C.a.GetRandomInt(0,2)?-.1:.1:n>0?-.1:.1;t.moveDriver=R.a.Builder.duration(Math.abs(s-n)/e).onAfterIteration(()=>{a(!1)}).start().ready,t.transform.x=N.animate(t.moveDriver,N.samplers.linear(n,s))};a(!0)}else t.transform.x=x.val(C.a.GetRandomFloat(-.1,.1));t.scoreGiven=!1;let e=void 0,a=void 0,n=s.a.getActiveEntities(...Object.keys(M.platforms)).filter(e=>e!==t);n.length<=0?e=-.14-i.colliderCenterOffset.y.sub(i.colliderSize.y.div(2)).pinLastValue():(a=n.sort((t,e)=>e.transform.y.sub(t.transform.y).pinLastValue())[0],e=a.transform.y.pinLastValue());let r=void 0===a?0:C.a.GetRandomFloat(H[a.type].minDistanceBetween.pinLastValue(),H[a.type].maxDistanceBetween.pinLastValue());if(t.transform.y=x.val(e+r),n.length>0){let e=C.a.chooseWeighted(M.entities);if(void 0===e)return;let i=s.a.getInactiveEntities(e);if(i.length<=0)return void K(e);let a=i[C.a.GetRandomInt(0,i.length)];t.entity=a,a.platform=t,a.spawn(),a.transform.position=t.sceneObject.transform.position.add(W[a.type].spawnPositionOffset)}}).addOnDeathEvent(t=>{void 0!==t.moveDriver&&null!==t.moveDriver&&(t.moveDriver.stop(),t.moveDriver=null),void 0!==t.entity&&null!==t.entity&&(t.sceneObject.name!==t.entity.platform.sceneObject.name&&G.log("^^^^^^^^^^^^^^^^ CRITICAL BUG DETECTED, CONTACT ME ASAP ^^^^^^^^^^^^^^^^"),t.entity.platform=null,t.entity.kill("platform death"),t.entity=null),t.scoreGiven=!1}).ready;let n=await j.root.findByPath(s.a.getEntityFolder()+"/"+t.name+"/*/block/Collider Drawer");n.length<=0&&!0===i.viewColliders.pinLastValue()?(G.log("WARNING: No entity of type '"+t.name+"' has 'Collider Drawer' block. You will not be able to view colliders of this entity instances"),G.log("To fix this, add 'Collider Drawer' block inside every main 'block' of each entity"),G.log("To HIDE this warning, turn 'View Colliders' setting of this type to 'false'"),G.log("This is optional. If the project is about to export, you can safely remove 'Collider Drawer' blocks")):n.length<=0&&!1===i.viewColliders.pinLastValue()?i.viewColliders.onOn().subscribe(()=>{G.log("WARNING: Add 'Collider Drawer' block to each entity instance and press 'Reload' button to view colliders")}):n.forEach(t=>{U(t,i)})}))}(),await async function(){let t=v.Builder.addX(X.colliderSize.x).addY(X.colliderSize.y).defineCenterOffset(X.colliderCenterOffset);J=(await j.root.findByPath("Device/EVENT SYSTEM/Data"))[0],null==J&&G.log("ERROR: Can't find 'Device/EVENT SYSTEM/Data'. Place this block at the given address");let e={colliderCenterOffset:X.colliderCenterOffset.add(x.vector(0,-.01,0)),viewColliders:x.val(!0),colliderSize:x.vector(c.a.verify(X.colliderSize.x).add(.01),c.a.verify(X.colliderSize.y).add(.01),c.a.verify(X.colliderSize.z).add(.01))},i=v.Builder.addX(e.colliderSize.x).addY(e.colliderSize.y).defineCenterOffset(e.colliderCenterOffset).onCollisionWithType(...Object.keys(M.platforms)).onEnter().doAction((t,e)=>{let i=t.transform.y.sub(t.collider.size.y.div(2)).add(t.collider.centerPositionOffset.y).pinLastValue();i+=.02,i>e.transform.y.add(e.collider.size.y.div(2)).add(e.collider.centerPositionOffset.y).pinLastValue()&&L.landOnCollider(e.collider)}).ready.onExit().doAction((t,e)=>{L.escapeFromCollider(e.collider)}).ready.ready;o.default.Builder.setName(X.block.name).addComponent(u.Builder).addComponent(t).addComponent(i).addOnStateChangedEvent(t=>{t.sceneObject.hidden=x.val(!t.active)}).addOnDamageEvent(t=>{t.health>0&&(f.a.pauseGame(),t.sceneObject.hidden=x.val(!0),O.a.setTimeout(()=>{f.a.resumeGame(),t.sceneObject.hidden=x.val(!1)},1e3)),Y.fireEvent(Y.events.onDamaged)}).setStartHealth(1).addOnDeathEvent(t=>{Y.fireEvent(Y.events.onDied)}).ready,(await j.root.findByPath(s.a.getEntityFolder()+"/"+X.block.name+"/*/block/Collider Drawer")).forEach(t=>{U(t,X)})}(),await a.a.loadAll(Z),e=!0};if(!0===t.pinLastValue())await i();else{G.log("WARNING: Script loading is DISABLED. Enable it at 'SETTINGS/Loading Settings'");let a=(new Date).getTime()-F;t.onOn().subscribe(()=>{!1===e&&(F=(new Date).getTime()-a,i())})}})})});let Q=[];O.a.setInterval(()=>{Q.length>0&&Q.shift()()},30);class ${constructor(){this.score=0,this.calculateBestScore()}changeScore(t){0!==t&&(this.score+=t,J.inputs.setScalar("SN",x.val(this.score)),J.inputs.setString("ST",x.val(this.score).toString()),t>0?Y.fireEvent(Y.events.onScoreAdded):Y.fireEvent(Y.events.onScoreSubtracted))}reset(){this.calculateBestScore(),this.score=0,J.inputs.setScalar("SN",x.val(this.score)),J.inputs.setString("ST",x.val(this.score).toString())}calculateBestScore(){let t=_.getKeyValue("best_score");this.score>t&&(_.setKeyValue("best_score",this.score),t=this.score),J.inputs.setScalar("BN",x.val(t)),J.inputs.setString("BT",x.val(t).toString())}}async function tt(t){return new Promise(e=>O.a.setTimeout(e,t))}}]);
/* Um9ra29FZmZlUEMKV2luZG93c19OVAp3aW4zMgp4NjQKMTAuMC4xODM2Mwo4MDI1NDcKMTY1NzE3NTY1NDQKVGh1IE5vdiAxMSAyMDIxIDE5OjQ3OjIyIEdNVCswMjAwIChHTVQrMDI6MDAp */
/* Powered by areyes.sdk // © areyes.studio 2021 */